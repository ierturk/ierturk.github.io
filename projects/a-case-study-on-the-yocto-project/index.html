<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer-when-downgrade">

    <title>A Case Study on the Yocto Project - Mare Nostrum</title>
    <meta name="description" content="It&#x27;s me!">

    
    <link rel="stylesheet" href="https://erturk.me/base.css">
    <link rel="stylesheet" href="https://erturk.me/auto.css">

    <link rel="preload" href=https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;font-awesome&#x2F;6.0.0-beta2&#x2F;css&#x2F;all.min.css as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href=https:&#x2F;&#x2F;cdnjs.cloudflare.com&#x2F;ajax&#x2F;libs&#x2F;font-awesome&#x2F;6.0.0-beta2&#x2F;css&#x2F;all.min.css></noscript>

    

    
    
    <meta property="og:locale" content="en_GB">
    
    <meta property="og:title" content="A Case Study on the Yocto Project">
    
    <meta property="og:type" content="article">
    <meta property="article:author" content="https://erturk.me/about/">
    <meta property="article:published_time" content="2022-08-20T00:29:04+03:00">
    
    
    <meta property="article:tag" content="software">
    
    <meta property="article:tag" content="embedded">
    
    <meta property="article:tag" content="qt">
    
    <meta property="article:tag" content="yocto">
    
    <meta property="article:tag" content="docker">
    
    <meta property="article:tag" content="openembedded">
    
    <meta property="article:tag" content="rpi">
    
    
    
    
    <meta property="og:url" content="https://erturk.me/projects/a-case-study-on-the-yocto-project/">
    
    
    <meta property="og:image" content="https://erturk.me/projects/a-case-study-on-the-yocto-project/yocto-project.jpeg">
    
    
    
    <meta property="og:description" content="Building a Barcode Reader From Beginning to End">
    


    
<link rel="stylesheet" href="https://erturk.me/mn.css">


<script>
  !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
  posthog.init('phc_k5Lrqb8gFFitvYEZRHMzhGYtEpxlGgIYt2rG8AzX9Sw',{api_host:'https://app.posthog.com'})
</script>


</head>
<body>
<div class="container">
    
    
    <header>
        <h1 class="site-header">
            <a href="https:&#x2F;&#x2F;erturk.me">Mare Nostrum</a>
        </h1>
        <nav>
            <ul>
            
            
                
                <li><a class="active" href="https:&#x2F;&#x2F;erturk.me&#x2F;projects">Projects</a></li>
            
                
                <li><a  href="https:&#x2F;&#x2F;erturk.me&#x2F;blog">Blog</a></li>
            
                
                <li><a  href="https:&#x2F;&#x2F;erturk.me&#x2F;about&#x2F;">About</a></li>
            
            
            </ul>
        </nav>
    </header>
    
    

<article class="post">
    
        
        
        
            
            
            
        
    <img src="https:&#x2F;&#x2F;erturk.me&#x2F;processed_images&#x2F;yocto-project.76d0dc516646a4ff.jpg" class="" alt="A Case Study on the Yocto Project"/>
    
    
    
        
        <header>
            <h1>A Case Study on the Yocto Project</h1>
            <h2 class="post-summary">Building a Barcode Reader From Beginning to End</h2>
        </header>
        
        
<div class="article-info">
    
    <div class="article-date">August 20, 2022</div>
    
    <div class="article-taxonomies">
        
        ◦
        <ul class="article-categories">
            
            <li><a href="https://erturk.me/categories/software/">software</a></li>
            
            <li><a href="https://erturk.me/categories/engineering/">engineering</a></li>
            
        </ul>
        
        
        <ul class="article-tags">
            
            <li><a href="https://erturk.me/tags/software/">#software</a></li>
            
            <li><a href="https://erturk.me/tags/embedded/">#embedded</a></li>
            
            <li><a href="https://erturk.me/tags/qt/">#qt</a></li>
            
            <li><a href="https://erturk.me/tags/yocto/">#yocto</a></li>
            
            <li><a href="https://erturk.me/tags/docker/">#docker</a></li>
            
            <li><a href="https://erturk.me/tags/openembedded/">#openembedded</a></li>
            
            <li><a href="https://erturk.me/tags/rpi/">#rpi</a></li>
            
        </ul>
        
    </div>
    
    
    <div class="article-github"> ◦
        <a href="https://www.github.com/ierturk/qt-qml-ai-collection">
        <span class="icon is-large">
          <i class="fa fas fa-star"></i>
        </span>
        3
        
        <span class="icon is-large">
          <i class="fa fas fa-code-branch"></i>
        </span>
        1
        
        </a>
    </div>
    
</div>

        
    
    
    <div class="content">
        
<span id="continue-reading"></span>
<p>In this post, it’ll be tried to explain what is Yocto Project by building a real world example - a barcode reader. So let’s start!</p>
<hr />
<h3 id="introduction">Introduction<a class="zola-anchor" href="#introduction" aria-label="Anchor link for: introduction">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>Following excerpt is taken from the Wikipedia article <sup class="footnote-reference"><a href="#1">1</a></sup> on the Yocto Project.</p>
<blockquote>
<p>The Yocto Project is a Linux Foundation collaborative open source project whose goal is to produce tools and processes that enable the creation of Linux distributions for embedded and IoT software that are independent of the underlying architecture of the embedded hardware. The project was announced by the Linux Foundation in 2010 and launched in March, 2011, in collaboration with 22 organizations, including OpenEmbedded.<sup class="footnote-reference"><a href="#2">2</a></sup></p>
</blockquote>
<p>This directly leads us to OpenEmbedded <sup class="footnote-reference"><a href="#2">2</a></sup> build system. So what is OpenEmbedded and OpenEmbedded build system? Following excerpt is taken from the Wikipedia article <sup class="footnote-reference"><a href="#3">3</a></sup> on the OpenEmbedded.</p>
<blockquote>
<p>OpenEmbedded is a build automation framework and cross-compile environment used to create Linux distributions for embedded devices. The OpenEmbedded framework is developed by the OpenEmbedded community, which was formally established in 2003. OpenEmbedded is the recommended build system of the Yocto Project, which is a Linux Foundation workgroup that assists commercial companies in the development of Linux-based systems for embedded products.</p>
<p>The build system is based on BitBake “recipes”, which specify how a particular package is built but also include lists of dependencies and source code locations, as well as for instructions on how to install and remove a compiled package. OpenEmbedded tools use these recipes to fetch and patch source code, compile and link binaries, produce binary packages (ipk, deb, rpm), and create bootable images.</p>
</blockquote>
<p>As can be seen from the above quotes about Yocto Project and OpenEmbedded, they are different from each other. However, they are often used interchangeably. In short;</p>
<blockquote>
<p><strong>Yocto is an umbrella project for building your own Linux Embedded distro</strong></p>
<p><strong>OpenEmbedded is a build system for Yocto</strong></p>
</blockquote>
<p>OpenEmbedded utilizes the tool <strong>BitBake</strong> for everthing as can be seen from above excerpt. In the next section, it’ll be tried to explain how to get OpenEmbedded build system <strong>BitBake</strong>.</p>
<hr />
<h3 id="how-to-prepare-the-host-system">How to Prepare the Host System<a class="zola-anchor" href="#how-to-prepare-the-host-system" aria-label="Anchor link for: how-to-prepare-the-host-system">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>Due to target system is Linux OS, the <strong>BitBake</strong> requires a Linux OS as host especially Debian/Ubuntu. A Linux VM On Windows or MacOS, or WSL on Windows can be used as build machine but not recommended due to performance issues and high demand for disk space. In any case, a Linux machine is required even virtual or native one. From now on, we have two options to install the build system on the host Linux machine.</p>
<ul>
<li>Directly installing the tools on the host.</li>
<li>Using Docker to get whole build system.</li>
</ul>
<p>The later option is used within this tutorial because while the first method mess the host system, the second method provides an isolated system. On Linux, both methods work with same performance because the Docker does not add an additional layer to work. However on Window adn MacOS, the Docker needs an additional Linux VM therefore the performance will be decreased.</p>
<p>From now on, we assume that we have a Debian/Ubuntu Linux Machine (Native or Virtual) and we have an access to machine over SSH console. If you don’t feel comfortable with the console, you can use teh VS Code Remote SSH plugin <sup class="footnote-reference"><a href="#4">4</a></sup>.</p>
<p>For the first method you can follow the document Yocto Project Quick Build <sup class="footnote-reference"><a href="#5">5</a></sup>.</p>
<p>For the second method, the Docker engine needs to be installed first. For this, you can follow the document Install Docker Engine on Debian <sup class="footnote-reference"><a href="#6">6</a></sup>. Also we need the <strong>git</strong> versioning tools. It can be installed as follow</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>$ sudo apt-get update
</span><span>$ sudo apt-get install git
</span></code></pre>
<hr />
<h3 id="how-to-get-the-openembedded-build-system">How to Get the OpenEmbedded Build System<a class="zola-anchor" href="#how-to-get-the-openembedded-build-system" aria-label="Anchor link for: how-to-get-the-openembedded-build-system">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>Now we have all required base tools on host, and we can get the <strong>BitBake</strong> from the <strong>Poky</strong> project as follow</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span># Create a working directory
</span><span>$ mkdir -p /mnt/Work/PROJs/rpi/yocto/src
</span><span>$ cd /mnt/Work/PROJs/rpi/yocto/src
</span><span>
</span><span># getting latest stable build system branch kirkstone from yocto project repos
</span><span>$ git clone https://git.yoctoproject.org/poky -b kirkstone
</span><span>
</span><span># return to yocto directory and run docker
</span><span>$ cd ..
</span><span>$ docker run --rm -it -v $(pwd):/workspace --workdir /workspace crops/poky:latest
</span><span>
</span><span># exit to return host command prompt
</span><span>$ exit
</span><span>
</span></code></pre>
<p>After the last command was issued, if the container images could not be found on local it will be downlaoded automatically from the <strong>Docker Hub</strong> and run the container, then you drop into container command line prompt. Now we have a whole build system but no source to build. We will get the sources in next section.</p>
<hr />
<h3 id="how-to-get-the-bitbake-layers">How to Get the BitBake Layers<a class="zola-anchor" href="#how-to-get-the-bitbake-layers" aria-label="Anchor link for: how-to-get-the-bitbake-layers">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>In <strong>BitBake</strong> concept, every group of source provides same functionality is called as <strong>Layer</strong> or <strong>Meta-Layer</strong>. Indeed, they are not a regular source code to build. They are some script in <strong>BitBake</strong> language that defines how to get sources, patch them, build them, their dependencies, and integrate into final target image. We need following Layers for our project.</p>
<ul>
<li><strong>meta-extra</strong> - a custom layer to add a regular sudo user</li>
<li><strong>meta-raspberrypi</strong> - the RPI board support package</li>
<li><strong>meta-openembedded</strong> - additional Linux tools</li>
<li><strong>meta-virtualization</strong> - the Docker support packages</li>
</ul>
<p>The sources can be downloaded from relevant locations as follow</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span># goto source folder
</span><span>$ cd /mnt/Work/PROJs/rpi/yocto/src
</span><span>
</span><span># meta-extra
</span><span>$ git clone https://github.com/ierturk/yocto-meta-extra.git -b kirkstone meta-extra
</span><span>
</span><span># meta-raspberrypi
</span><span>$ git clone https://git.yoctoproject.org/meta-raspberrypi -b kirkstone
</span><span>
</span><span># meta-openembedded
</span><span>$ git clone https://git.openembedded.org/meta-openembedded -b kirkstone
</span><span>
</span><span># meta-virtualization
</span><span>$ git clone https://git.yoctoproject.org/meta-virtualization -b kirkstone
</span></code></pre>
<p>Now we have all the source to build the target image.</p>
<hr />
<h3 id="configuring-and-building-target-image">Configuring and Building Target Image<a class="zola-anchor" href="#configuring-and-building-target-image" aria-label="Anchor link for: configuring-and-building-target-image">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>Our target images will be used for developing, it will have lots of tools which will not have an productions image, therefore it will be larger then a production image. However we will follow a different appraching to develop an application. We will use the Docker for the applications and all the required packages which are not included in base image will be included within the Docker containers.</p>
<p>Now we can start to configure and build the image</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span># goto yocto directory and run Docker
</span><span>$ cd /mnt/Work/PROJs/rpi/yocto/src
</span><span>$ docker run --rm -it -v $(pwd):/workspace --workdir /workspace crops/poky:latest
</span><span>
</span><span># We will drop into container command promt.
</span><span># Now the directory /mnt/Work/PROJs/rpi/yocto/src will be mounted
</span><span># as /workspace within the container, and we are in this directory.
</span><span>
</span><span># Following command start a new build directory,
</span><span># and automatically drop into build directory
</span><span>$ . src/poky/oe-init-build-env
</span><span>### Shell environment set up for builds. ###
</span><span>
</span><span>You can now run &#39;bitbake &lt;target&gt;&#39;
</span><span>
</span><span>Common targets are:
</span><span>    core-image-minimal
</span><span>    core-image-full-cmdline
</span><span>    core-image-sato
</span><span>    core-image-weston
</span><span>    meta-toolchain
</span><span>    meta-ide-support
</span><span>
</span><span>You can also run generated qemu images with a command like &#39;runqemu qemux86&#39;
</span><span>
</span><span>Other commonly useful commands are:
</span><span> - &#39;devtool&#39; and &#39;recipetool&#39; handle common recipe tasks
</span><span> - &#39;bitbake-layers&#39; handles common layer tasks
</span><span> - &#39;oe-pkgdata-util&#39; handles common target package tasks
</span></code></pre>
<p>Then you should have a following directory tree under the directory <strong>yocto</strong>.</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>|-- build
</span><span>|   |-- conf
</span><span>|   |   |-- bblayers.conf
</span><span>|   |   |-- local.conf
</span><span>|   |   `-- templateconf.cfg
</span><span>`-- src
</span><span>    |-- meta-extra
</span><span>    |-- meta-openembedded
</span><span>    |-- meta-raspberrypi
</span><span>    |-- meta-virtualization
</span><span>    `-- poky
</span></code></pre>
<p>Now we need to edit the files <strong>bblayers.conf</strong> and <strong>local.conf</strong>. They are created with the contents, and needs to be applied following patches.</p>
<p>The patch for <strong>bblayers.conf</strong></p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>diff initial/bblayers.conf final/bblayers.conf 
</span><span>11a12,19
</span><span>&gt;   ${TOPDIR}/../src/meta-raspberrypi \
</span><span>&gt;   ${TOPDIR}/../src/meta-openembedded/meta-oe \
</span><span>&gt;   ${TOPDIR}/../src/meta-openembedded/meta-multimedia \
</span><span>&gt;   ${TOPDIR}/../src/meta-openembedded/meta-networking \
</span><span>&gt;   ${TOPDIR}/../src/meta-openembedded/meta-python \
</span><span>&gt;   ${TOPDIR}/../src/meta-openembedded/meta-filesystems \
</span><span>&gt;   ${TOPDIR}/../src/meta-virtualization \
</span><span>&gt;   ${TOPDIR}/../src/meta-extra \
</span></code></pre>
<p>The patch for <strong>local.conf</strong></p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>diff initial/local.conf final/local.conf 
</span><span>36a37,38
</span><span>&gt; MACHINE ?= &quot;raspberrypi3-64&quot;
</span><span>&gt; #
</span><span>108c110
</span><span>&lt; PACKAGE_CLASSES ?= &quot;package_rpm&quot;
</span><span>---
</span><span>&gt; PACKAGE_CLASSES ?= &quot;package_ipk&quot;
</span><span>276a279,344
</span><span>&gt; 
</span><span>&gt; # IMAGE_ROOTFS_EXTRA_SPACE = &quot;16777216&quot;
</span><span>&gt; 
</span><span>&gt; # Systemd enable
</span><span>&gt; DISTRO_FEATURES:append = &quot; systemd&quot;
</span><span>&gt; VIRTUAL-RUNTIME_init_manager = &quot;systemd&quot;
</span><span>&gt; DISTRO_FEATURES_BACKFILL_CONSIDERED = &quot;sysvinit&quot;
</span><span>&gt; VIRTUAL-RUNTIME_initscripts = &quot;&quot;
</span><span>&gt; 
</span><span>&gt; # Extra Users
</span><span>&gt; DISTRO_FEATURES:append = &quot; pam&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; extra-sudo&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; extra-user&quot;
</span><span>&gt; 
</span><span>&gt; # Image features
</span><span>&gt; IMAGE_FEATURES:append = &quot; hwcodecs bash-completion-pkgs&quot;
</span><span>&gt; 
</span><span>&gt; # Kernel Modules All
</span><span>&gt; # IMAGE_INSTALL:append = &quot; kernel-modules&quot;
</span><span>&gt; # IMAGE_INSTALL:append = &quot; linux-firmware&quot;
</span><span>&gt; 
</span><span>&gt; # OpenGL
</span><span>&gt; DISTRO_FEATURES:append = &quot; opengl&quot;
</span><span>&gt; 
</span><span>&gt; # Dev Tools
</span><span>&gt; IMAGE_FEATURES:append = &quot; tools-debug&quot;
</span><span>&gt; EXTRA_IMAGE_FEATURES:append = &quot; ssh-server-openssh&quot;
</span><span>&gt; 
</span><span>&gt; # Virtualization
</span><span>&gt; DISTRO_FEATURES:append = &quot; virtualization&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; docker-ce&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; python3-docker-compose&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; python3-distutils&quot;
</span><span>&gt; 
</span><span>&gt; # Network manager
</span><span>&gt; IMAGE_INSTALL:append = &quot; wpa-supplicant&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; networkmanager&quot; 
</span><span>&gt; IMAGE_INSTALL:append = &quot; modemmanager&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; networkmanager-nmcli&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; networkmanager-nmtui&quot;
</span><span>&gt; 
</span><span>&gt; # USB Camera
</span><span>&gt; IMAGE_INSTALL:append = &quot; kernel-module-uvcvideo&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; v4l-utils&quot;
</span><span>&gt; 
</span><span>&gt; # RPi
</span><span>&gt; ENABLE_UART = &quot;1&quot;
</span><span>&gt; 
</span><span>&gt; # Date Time Daemon
</span><span>&gt; # IMAGE_INSTALL:append = &quot; ntpdate&quot;
</span><span>&gt; 
</span><span>&gt; # Tools
</span><span>&gt; IMAGE_INSTALL:append = &quot; git&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; curl&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; wget&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; rsync&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; sudo&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; nano&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; socat&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; tzdata&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; e2fsprogs-resize2fs gptfdisk parted util-linux udev&quot;
</span><span>&gt; 
</span><span>&gt; # VS Code reqs
</span><span>&gt; IMAGE_INSTALL:append = &quot; ldd&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; glibc&quot;
</span><span>&gt; IMAGE_INSTALL:append = &quot; libstdc++&quot;
</span></code></pre>
<p>Now just type following command and then you need to wait some quite considerable time to get the target image.</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>$ bitbake core-image-base
</span></code></pre>
<hr />
<h3 id="flashing-the-image">Flashing the Image<a class="zola-anchor" href="#flashing-the-image" aria-label="Anchor link for: flashing-the-image">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>You will find the image as <strong>build/tmp/deploy/images/raspberrypi3-64/core-image-base-raspberrypi3-64.wic.bz2</strong>. The image can be flashed as follow in a <strong>Unix</strong> system.</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span># Unzip image
</span><span>$ bzip2 -d -f ./core-image-base-raspberrypi3-64.wic.bz2
</span><span>
</span><span># Flash to SD Card
</span><span># Here you need to change sdX with your SD Card reader device.
</span><span>$ sudo dd if=./core-image-base-raspberrypi3.wic of=/dev/sdX bs=1m 
</span></code></pre>
<hr />
<h3 id="the-first-run">The First Run<a class="zola-anchor" href="#the-first-run" aria-label="Anchor link for: the-first-run">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>Finally you have an SD Card has <strong>RPI3-64 bit OS</strong> image. Just plug into your <strong>RPI3</strong>, then power up. If you already know your RPI IP address you can login as root without password over SSH console, or with the user <strong>ierturk</strong> wit the defult password <strong>1200</strong>. At first login the system request to change password for the user <strong>ierturk</strong>. This user also is a <strong>sudo</strong> user.</p>
<hr />
<h3 id="additional-tune-up">Additional Tune Up<a class="zola-anchor" href="#additional-tune-up" aria-label="Anchor link for: additional-tune-up">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>For retain the image size to be smaller and fits to any SD Card, the root file system was retained as small as possible. Now it needs to be expanded as follow.</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span># login as root user over SSH
</span><span>$ ssh root@ip_address_of_the_rpi
</span><span>
</span><span># following command list your memory blocks
</span><span>$ lsblk
</span><span>NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
</span><span>mmcblk0     179:0    0  XXXG  0 disk 
</span><span>|-mmcblk0p1 179:1    0 69.1M  0 part /boot
</span><span>`-mmcblk0p2 179:2    0   XXG  0 part /
</span><span>
</span><span># here mmcblk0p2 needs to be expanded to its max
</span><span>$ parted /dev/mmcblk0 resizepart 2 100%
</span><span>$ resize2fs /dev/mmcblk0p2
</span><span>
</span><span># then it looks like as follow
</span><span>$ lsblk
</span><span>NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
</span><span>mmcblk0     179:0    0 29.1G  0 disk 
</span><span>|-mmcblk0p1 179:1    0 69.1M  0 part /boot
</span><span>`-mmcblk0p2 179:2    0   29G  0 part /
</span></code></pre>
<p>Finally everything is OK. Now type following command to test your Docker installation</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>$ docker info
</span><span>Client:
</span><span> Context:    default
</span><span> Debug Mode: false
</span><span>
</span><span>Server:
</span><span> Containers: 0
</span><span>  Running: 0
</span><span>  Paused: 0
</span><span>  Stopped: 0
</span><span> Images: 2
</span><span> Server Version: 20.10.12-ce
</span><span> Storage Driver: overlay2
</span><span>  Backing Filesystem: extfs
</span><span>  Supports d_type: true
</span><span>  Native Overlay Diff: true
</span><span>  userxattr: false
</span><span> Logging Driver: json-file
</span><span> Cgroup Driver: cgroupfs
</span><span> Cgroup Version: 1
</span><span> Plugins:
</span><span>  Volume: local
</span><span>  Network: bridge host ipvlan macvlan null overlay
</span><span>  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
</span><span> Swarm: inactive
</span><span> Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc
</span><span> Default Runtime: runc
</span><span> Init Binary: docker-init
</span><span> containerd version: d12516713c315ea9e651eb1df89cf32ff7c8137c.m
</span><span> runc version: v1.1.2-9-gb507e2da-dirty
</span><span> init version: b9f42a0-dirty
</span><span> Kernel Version: 5.15.34-v8
</span><span> Operating System: Poky (Yocto Project Reference Distro) 4.0.2 (kirkstone)
</span><span> OSType: linux
</span><span> Architecture: aarch64
</span><span> CPUs: 4
</span><span> Total Memory: 909MiB
</span><span> Name: raspberrypi3-64
</span><span> ID: SKCZ:5JOV:CLCE:ECSC:UJ46:VGCH:YAFW:TNOF:J3FN:WO26:FHIO:BHRR
</span><span> Docker Root Dir: /var/lib/docker
</span><span> Debug Mode: false
</span><span> Registry: https://index.docker.io/v1/
</span><span> Labels:
</span><span> Experimental: false
</span><span> Insecure Registries:
</span><span>  127.0.0.0/8
</span><span> Live Restore Enabled: false
</span><span>
</span><span>WARNING: No memory limit support
</span><span>WARNING: No swap limit support
</span><span>WARNING: No kernel memory TCP limit support
</span><span>WARNING: No oom kill disable support
</span><span>WARNING: No blkio throttle.read_bps_device support
</span><span>WARNING: No blkio throttle.write_bps_device support
</span><span>WARNING: No blkio throttle.read_iops_device support
</span><span>WARNING: No blkio throttle.write_iops_device support
</span></code></pre>
<p>Now we have a base system without any <strong>Desktop</strong> to develop an application using <strong>Docker</strong>.</p>
<hr />
<h3 id="developing-a-simple-barcode-reader-application-using-the-docker-containers-and-docker-compose-without-modifying-the-base-system">Developing a Simple Barcode Reader Application using the Docker Containers and Docker Compose without Modifying the Base System<a class="zola-anchor" href="#developing-a-simple-barcode-reader-application-using-the-docker-containers-and-docker-compose-without-modifying-the-base-system" aria-label="Anchor link for: developing-a-simple-barcode-reader-application-using-the-docker-containers-and-docker-compose-without-modifying-the-base-system">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>We’ll use two Docker container for the application as follow</p>
<ul>
<li>Window manager with VNC support as wayland server</li>
<li>Application server as wayland client</li>
</ul>
<p>Now we need to build them. For this purpose, the container images can be built locally by using the <strong>Docker build</strong> <sup class="footnote-reference"><a href="#7">7</a></sup> or for multiple architecture by using <strong>the Docker buildx</strong> <sup class="footnote-reference"><a href="#8">8</a></sup>.</p>
<p>In this tutorial, we’ll follow another approacging for building the containers. We’ll use <strong>GitHub</strong> actions to build and push the containers to the HubDocker automatically as CI/CD. We need a recipe file which is called <strong>Dockerfile</strong> to build a container image. The <strong>Alpine Linux</strong> <sup class="footnote-reference"><a href="#9">9</a></sup> is used for the containers to get smaller container images here. Following Dockerfile is for the container that contains a windows manager SwayWm <sup class="footnote-reference"><a href="#10">10</a></sup> (a wayland compositor) with VNC support. It’s just looks like a <strong>bash script</strong>.</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span># Dockerfile SwayWM
</span><span>ARG ALPINE_VERSION=3.16
</span><span>FROM alpine:${ALPINE_VERSION}
</span><span>
</span><span>ENV USER=&quot;vnc-user&quot; \
</span><span>    APK_ADD=&quot;mesa-dri-swrast openssl socat sway xkeyboard-config&quot; \
</span><span>    APK_DEL=&quot;bash curl&quot; \
</span><span>    VNC_LISTEN_ADDRESS=&quot;0.0.0.0&quot; \
</span><span>    VNC_AUTH_ENABLE=&quot;false&quot; \
</span><span>    VNC_KEYFILE=&quot;key.pem&quot; \
</span><span>    VNC_CERT=&quot;cert.pem&quot; \
</span><span>    VNC_PASS=&quot;$(pwgen -yns 8 1)&quot;
</span><span>
</span><span>RUN apk update \
</span><span>    &amp;&amp; apk upgrade
</span><span>
</span><span># Add packages
</span><span>RUN apk add --no-cache $APK_ADD
</span><span>
</span><span># Add fonts
</span><span>RUN apk add --no-cache msttcorefonts-installer fontconfig \
</span><span>    &amp;&amp; update-ms-fonts
</span><span>
</span><span># Add application user
</span><span>RUN addgroup -g 1000 $USER &amp;&amp; adduser -u 1000 -G $USER -h /home/$USER -D $USER
</span><span>
</span><span># Iinstall vnc packages
</span><span>RUN apk add --no-cache wayvnc neatvnc
</span><span>
</span><span># Copy sway config
</span><span>COPY assets/swayvnc/config /etc/sway/config
</span><span>COPY assets/swayvnc/kms.conf /etc/kms.conf
</span><span>
</span><span># Add wayvnc to compositor startup and put IPC on the network
</span><span>RUN mkdir /etc/sway/config.d \
</span><span>    &amp;&amp; echo &quot;exec wayvnc 0.0.0.0 5900&quot; &gt;&gt; /etc/sway/config.d/exec \
</span><span>    &amp;&amp; echo &quot;exec \&quot;socat TCP-LISTEN:7023,fork UNIX-CONNECT:/run/user/1000/sway-ipc.sock\&quot;&quot; &gt;&gt; /etc/sway/config.d/exec \
</span><span>    &amp;&amp; mkdir -p /home/$USER/.config/wayvnc/ \
</span><span>    &amp;&amp; printf &quot;\
</span><span>address=$VNC_LISTEN_ADDRESS\n\
</span><span>enable_auth=$VNC_AUTH_ENABLE\n\
</span><span>username=$USER\n\
</span><span>password=$VNC_PASS\n\
</span><span>private_key_file=/home/$USER/$VNC_KEYFILE\n\
</span><span>certificate_file=/home/$USER/$VNC_CERT&quot; &gt; /home/$USER/.config/wayvnc/config
</span><span>
</span><span># Generate certificates vor VNC
</span><span>RUN openssl req -x509 -newkey rsa:4096 -sha256 -days 3650 -nodes \
</span><span>	-keyout key.pem -out cert.pem -subj /CN=localhost \
</span><span>	-addext subjectAltName=DNS:localhost,DNS:localhost,IP:127.0.0.1
</span><span>
</span><span># Add entrypoint
</span><span>USER $USER
</span><span>COPY assets/swayvnc/entrypoint.sh /
</span><span>ENTRYPOINT [&quot;/entrypoint.sh&quot;]
</span></code></pre>
<p>And following YML file is for Github Action. With these files, you’ll get Dockar container images on DockerHub with three architecture (linux/amd64, linux/arm64, linux/arm/v7).</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>name: Alpine SwayVnc
</span><span>
</span><span>on:
</span><span>  push:
</span><span>    branches:
</span><span>      - master
</span><span>
</span><span>jobs:
</span><span>  docker:
</span><span>    runs-on: ubuntu-latest
</span><span>    steps:
</span><span>      -
</span><span>        name: Checkout
</span><span>        uses: actions/checkout@v3
</span><span>      -
</span><span>        name: Docker meta
</span><span>        id: meta
</span><span>        uses: docker/metadata-action@v4
</span><span>        with:
</span><span>          images: |
</span><span>            ierturk/alpine-swayvnc
</span><span>          tags: |
</span><span>            type=raw,value={{date &#39;YYYYMMDD-hhmm&#39;}}
</span><span>      -
</span><span>        name: Set up QEMU
</span><span>        uses: docker/setup-qemu-action@v2
</span><span>      -
</span><span>        name: Set up Docker Buildx
</span><span>        uses: docker/setup-buildx-action@v2
</span><span>      -
</span><span>        name: Login to DockerHub
</span><span>        uses: docker/login-action@v2
</span><span>        with:
</span><span>          username: ${{ secrets.DOCKER_HUB_USERNAME }}
</span><span>          password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
</span><span>      -
</span><span>        name: Build and push
</span><span>        uses: docker/build-push-action@v3
</span><span>        with:
</span><span>          context: ./Alpine
</span><span>          file: ./Alpine/swayvnc.Dockerfile
</span><span>          platforms: linux/amd64, linux/arm64, linux/arm/v7
</span><span>          push: true
</span><span>          tags: ${{ steps.meta.outputs.tags }}, ierturk/alpine-swayvnc:latest
</span><span>          labels: ${{ steps.meta.outputs.labels }}
</span><span>          cache-from: type=registry,ref=ierturk/alpine-swayvnc:latest
</span><span>          cache-to: type=inline
</span><span>      -
</span><span>        name: Image digest
</span><span>        run: echo ${{ steps.docker_build.outputs.digest }}
</span></code></pre>
<p>All the sources can be found on the relevant GitHub repo <sup class="footnote-reference"><a href="#11">11</a></sup>. All required containers will be also built then pushed by this repo using GitHub actions. Now the containers is ready for using on <strong>DockerHub</strong> <sup class="footnote-reference"><a href="#12">12</a></sup>. Now it can be typed following line to run the container, and can be connected to <strong>Desktop SwayWM</strong> by a <strong>VNC Viewer</strong> <sup class="footnote-reference"><a href="#13">13</a></sup>.</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>$ export LISTEN_ADDRESS=&quot;0.0.0.0&quot;; docker run -e XDG_RUNTIME_DIR=/tmp \
</span><span>             -e WLR_BACKENDS=headless \
</span><span>             -e WLR_LIBINPUT_NO_DEVICES=1 \
</span><span>             -e SWAYSOCK=/tmp/sway-ipc.sock
</span><span>             -p${LISTEN_ADDRESS}:5900:5900 \
</span><span>             -p${LISTEN_ADDRESS}:7023:7023 ierturk/alpine-swayvnc
</span></code></pre>
<p>Then you’ll see your Desktop for the first time. This is not a regular Desktop but a lightweight one.
<img src="https://erturk.me/projects/a-case-study-on-the-yocto-project/./swaywm-vnc-on-rpi3.png" alt="SwayWm-Vnc" /></p>
<p>However, it is not a proper way to start containers by typing a long commandline. Fortunately there is another tool for doing this with more convenient way. We’ll use to run containers by using the tool <strong>Docker-Compose</strong> <sup class="footnote-reference"><a href="#14">14</a></sup>. The Docker-Compose uses a YML file to run the containers. This is another recipe to run multiple containers at once. It looks like as follow</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>version: &#39;2.4&#39;
</span><span>
</span><span>services:
</span><span>  swayvnc:
</span><span>    image: ierturk/alpine-swayvnc:latest
</span><span>    volumes:
</span><span>      - type: bind
</span><span>        source: /tmp
</span><span>        target: /tmp
</span><span>      - type: bind
</span><span>        source: /run/user/1000
</span><span>        target: /run/user/1000
</span><span>      - type: bind
</span><span>        source: /dev
</span><span>        target: /dev
</span><span>      - type: bind
</span><span>        source: /run/udev
</span><span>        target: /run/udev
</span><span>      - type: bind
</span><span>        source: ../..
</span><span>        target: /workspace
</span><span>    cap_add:
</span><span>      - CAP_SYS_TTY_CONFIG
</span><span>    # Add device access rights through cgroup...
</span><span>    device_cgroup_rules:
</span><span>      # ... for tty0
</span><span>      - &#39;c 4:0 rmw&#39;
</span><span>      # ... for tty7
</span><span>      - &#39;c 4:7 rmw&#39;
</span><span>      # ... for /dev/input devices
</span><span>      - &#39;c 13:* rmw&#39;
</span><span>      - &#39;c 199:* rmw&#39;
</span><span>      # ... for /dev/dri devices
</span><span>      - &#39;c 226:* rmw&#39;
</span><span>      - &#39;c 81:* rmw&#39;
</span><span>    entrypoint: /entrypoint.sh
</span><span>    network_mode: host
</span><span>    privileged: true
</span><span>    environment:
</span><span>      - XDG_RUNTIME_DIR=/run/user/1000
</span><span>      - WLR_BACKENDS=headless
</span><span>      - WLR_LIBINPUT_NO_DEVICES=1
</span><span>      - SWAYSOCK=/run/user/1000/sway-ipc.sock
</span><span>
</span><span>  app:
</span><span>    image: ierturk/alpine-dev-qt:latest
</span><span>    security_opt:
</span><span>      - seccomp:unconfined
</span><span>    shm_size: &#39;256mb&#39;
</span><span>    volumes:
</span><span>      - type: bind
</span><span>        source: /tmp
</span><span>        target: /tmp
</span><span>      - type: bind
</span><span>        source: /run/user/1000
</span><span>        target: /run/user/1000
</span><span>      - type: bind
</span><span>        source: /dev
</span><span>        target: /dev
</span><span>      - type: bind
</span><span>        source: /run/udev
</span><span>        target: /run/udev
</span><span>      - type: bind
</span><span>        source: ../..
</span><span>        target: /workspace
</span><span>      # - type: bind
</span><span>      #   source: ~/.ssh
</span><span>      #   target: /home/ierturk/.ssh
</span><span>      #   read_only: true
</span><span>    cap_add:
</span><span>      - CAP_SYS_TTY_CONFIG
</span><span>      - SYS_PTRACE
</span><span>    # Add device access rights through cgroup...
</span><span>    device_cgroup_rules:
</span><span>      # ... for tty0
</span><span>      - &#39;c 4:0 rmw&#39;
</span><span>      # ... for tty7
</span><span>      - &#39;c 4:7 rmw&#39;
</span><span>      # ... for /dev/input devices
</span><span>      - &#39;c 13:* rmw&#39;
</span><span>      - &#39;c 199:* rmw&#39;
</span><span>      # ... for /dev/dri devices
</span><span>      - &#39;c 226:* rmw&#39;
</span><span>      - &#39;c 81:* rmw&#39;
</span><span>    stdin_open: true
</span><span>    tty: true
</span><span>    network_mode: host
</span><span>    privileged: true
</span><span>    environment:
</span><span>      - WAYLAND_USER=ierturk
</span><span>      - XDG_RUNTIME_DIR=/run/user/1000
</span><span>      - WAYLAND_DISPLAY=wayland-1
</span><span>      - DISPLAY=:0
</span><span>      - QT_QPA_PLATFORM=wayland
</span><span>      - QT_QPA_EGLFS_INTEGRATION=&quot;eglfs_kms&quot;
</span><span>      - QT_QPA_EGLFS_KMS_ATOMIC=&quot;1&quot;
</span><span>      - QT_QPA_EGLFS_KMS_CONFIG=&quot;/etc/kms.conf&quot;      
</span><span>      - IGNORE_X_LOCKS=1
</span><span>      - QT_IM_MODULE=qtvirtualkeyboard
</span><span>    user: ierturk
</span><span>    working_dir: /workspace
</span><span>    depends_on:
</span><span>      - swayvnc
</span></code></pre>
<p>There are two services definition here. One of them for Display manager and the other one is for the application. Now it can be just typed as follow for everything ups an running.</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>$ docker-compose -f Alpine/swayvnc-dc.yml up -d
</span><span>Creating alpine_swayvnc_1 ... done
</span><span>Creating alpine_app_1     ... done
</span></code></pre>
<p>Now they are all up and running and connected to each other and the base system resources. From now on, we can login to app container as follow</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>$ docker exec -it alpine_app_1 ash
</span></code></pre>
<p>And we can run any arbitrary application here, we’ll try a Barcode Reader - ZXing-C++ <sup class="footnote-reference"><a href="#15">15</a></sup>. For sample UI we’ll use <strong>OpenCV</strong> <sup class="footnote-reference"><a href="#16">16</a></sup> and <strong>Qt5 - QuickControl 2</strong> <sup class="footnote-reference"><a href="#17">17</a></sup> (QML Types) and a <strong>USB Camera</strong>. The Barcode Reader Library sources can be downloaded and build by <strong>CMake</strong> <sup class="footnote-reference"><a href="#18">18</a></sup> as follow</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>$ git clone https://github.com/nu-book/zxing-cpp.git
</span><span>
</span><span># then go into zxing-cpp directory and craete a build folder
</span><span>$ cd zxing-cpp
</span><span>$ mkdir build
</span><span>$ cd build
</span><span>$ cmake ..
</span><span>$ make
</span><span>
</span><span># then run the application
</span><span>$ ./example/ZXingOpenCV
</span></code></pre>
<p>You may get some screen looks like following images
<img src="https://erturk.me/projects/a-case-study-on-the-yocto-project/./barcode-omar-khayyam.png" alt="Omar Khayyam - Rubailer" />
<img src="https://erturk.me/projects/a-case-study-on-the-yocto-project/./barcode-anne-frank.png" alt="Anne Frank - Diary" /></p>
<p>If everthing went well we can exit the container commandline, the shut down all the containers as follow</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span># close app application
</span><span># just press CTRL-C
</span><span>$ exit
</span><span>$ docker-compose -f Alpine/swayvnc-dc.yml down
</span><span>Stopping alpine_app_1     ... done
</span><span>Stopping alpine_swayvnc_1 ... done
</span><span>Removing alpine_app_1     ... done
</span><span>Removing alpine_swayvnc_1 ... done
</span></code></pre>
<p>Therefore, there will be nothing left, the containers will be stopped and deleted.</p>
<p>And finally this my <strong>RPI3</strong> with a <strong>USB Camera</strong>.
<img src="https://erturk.me/projects/a-case-study-on-the-yocto-project/./RPI3-with-Camera.jpeg" alt="RPI3 wit a USB Camera" /></p>
<hr />
<h3 id="conclusion">Conclusion<a class="zola-anchor" href="#conclusion" aria-label="Anchor link for: conclusion">
    <svg class="zola-anchor-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
        <path fill-rule="evenodd"
            d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z">
        </path>
    </svg>
</a>
</h3>
<p>Until now, we developed the whole system from scratch. And it woks as you can see. Yo can work on this and modify some parts according to your requirements.</p>
<p>Hope you enjoyed with the tutorial, found useful.
Thank you for reading.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p><a href="https://en.wikipedia.org/wiki/Yocto_Project">Yocto Project article on Wikipedia</a></p>
</div>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p><a href="https://www.openembedded.org">OpenEmbedded Build System</a></p>
</div>
<div class="footnote-definition" id="3"><sup class="footnote-definition-label">3</sup>
<p><a href="https://en.wikipedia.org/wiki/OpenEmbedded">OpenEmbedded article on Wikipedia</a></p>
</div>
<div class="footnote-definition" id="4"><sup class="footnote-definition-label">4</sup>
<p><a href="https://code.visualstudio.com/docs/remote/ssh">VS Code Remote SSH plugin</a></p>
</div>
<div class="footnote-definition" id="5"><sup class="footnote-definition-label">5</sup>
<p><a href="https://docs.yoctoproject.org/brief-yoctoprojectqs/index.html">Yocto Project Quick Build</a></p>
</div>
<div class="footnote-definition" id="6"><sup class="footnote-definition-label">6</sup>
<p><a href="https://docs.docker.com/engine/install/debian/">Install Docker Engine on Debian</a></p>
</div>
<div class="footnote-definition" id="7"><sup class="footnote-definition-label">7</sup>
<p><a href="https://docs.docker.com/engine/reference/commandline/build/">docker build</a></p>
</div>
<div class="footnote-definition" id="8"><sup class="footnote-definition-label">8</sup>
<p><a href="https://docs.docker.com/build/buildx/">Working with Buildx</a></p>
</div>
<div class="footnote-definition" id="9"><sup class="footnote-definition-label">9</sup>
<p><a href="https://www.alpinelinux.org">Alpine Linux</a></p>
</div>
<div class="footnote-definition" id="10"><sup class="footnote-definition-label">10</sup>
<p><a href="https://swaywm.org">Sway WM</a></p>
</div>
<div class="footnote-definition" id="11"><sup class="footnote-definition-label">11</sup>
<p><a href="https://github.com/ierturk/dev-containers">GitHub Repo Dev-Containers</a></p>
</div>
<div class="footnote-definition" id="12"><sup class="footnote-definition-label">12</sup>
<p><a href="https://hub.docker.com/u/ierturk">DockerHub / ierturk</a></p>
</div>
<div class="footnote-definition" id="13"><sup class="footnote-definition-label">13</sup>
<p><a href="https://www.realvnc.com/en/connect/download/viewer/">VNC Viewer</a></p>
</div>
<div class="footnote-definition" id="14"><sup class="footnote-definition-label">14</sup>
<p><a href="https://docs.docker.com/compose/">Docker Compose</a></p>
</div>
<div class="footnote-definition" id="15"><sup class="footnote-definition-label">15</sup>
<p><a href="https://github.com/nu-book/zxing-cpp">Barcode Reader - ZXing-C++</a></p>
</div>
<div class="footnote-definition" id="16"><sup class="footnote-definition-label">16</sup>
<p><a href="https://opencv.org">OpenCV</a></p>
</div>
<div class="footnote-definition" id="17"><sup class="footnote-definition-label">17</sup>
<p><a href="https://doc.qt.io/qt-5/qtquick-controls2-qmlmodule.html">Qt5 - QuickControl 2</a></p>
</div>
<div class="footnote-definition" id="18"><sup class="footnote-definition-label">18</sup>
<p><a href="https://cmake.org">CMake</a></p>
</div>

    </div>
    

    
</article>


    <footer>
        <p>
            
<span class="icon-text">
  

  

  
  <a href="https://github.com/ierturk" aria-label="Open ierturk GitHub" target="_blank">
    <span class="icon is-large">
      <i class="fab fa-github fa-lg" aria-hidden="true" title="GitHub"></i>
    </span>
  </a>
  

  
  <a href="https://www.linkedin.com/in/ierturk" aria-label="Open ierturk LinkedIn" target="_blank">
    <span class="icon is-large">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true" title="LinkedIn"></i>
    </span>
  </a>
  

  

  

  

  
  <a href="mailto:me@erturk.me" aria-label="Email me@erturk.me" target="_blank">
    <span class="icon is-large">
      <i class="far fa-envelope fa-lg" aria-hidden="true" title="email"></i>
    </span>
  </a>
  

  

  
</span>

        </p>
        <p>
            
            
        </p>
    </footer>
</div>
</body>
</html>
